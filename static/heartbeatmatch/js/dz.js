
var DZ={_version:"1.0.0",SETTING_PROTOCOL:'http:',SETTING_HOST_SITE:'http://www.deezer.com',SETTING_HOST_CONNECT:'https://connect.deezer.com',SETTING_HOST_API:'https://api.deezer.com/2.0',SETTING_HOST_APP:null,CONST_LOADED:false,WIDGET_TYPE_PLAYER:'dzplayer',DEBUG:false,dz_root:null,token:null,tokenExpire:null,tokenExpireTimeout:null,app_id:null,user_id:null,channelUrl:null,fb_logged:false,initialized:false,has_player:false,is_inapp:false,clearDeezer:function(){try{Events.unsubscribeAll('DZ');DZ.SETTING_HOST_APP=null;DZ.CONST_LOADED=false;DZ.fb_logged=false;DZ.initialized=false;DZ.has_player=false;DZ.app_id=null;DZ.channelUrl=null;DZ.user_id=null;DZ.token=null;DZ.tokenExpire=null;DZ.tokenExpireTimeout=null;DZ.dz_root=null;DZ.inapploadedCount=0;}catch(e){DZ.catchException(e);}},_override_pp:function(){DZ.SETTING_HOST_SITE="http://preprod.deezer.com";DZ.SETTING_HOST_CONNECT="https://preprod-connect.deezer.com";DZ.SETTING_HOST_API="https://preprod-api.deezer.com/2.0";},checkChannel:function(){},setChannelUrl:function(channel_url){var url=DZ.util.parseUrl(channel_url);DZ.channelUrl=channel_url;DZ.SETTING_HOST_APP=url.protocol+"://"+url.host;},inapp_history:{history:[''],push:function(url){DZ.inapp_history.history.push(url);DZ.inapp_history.display();},pop:function(){},back:function(){},display:function(){$('#history_follow').html(DZ.inapp_history.history.join('<br/>'));}},onDeezerLoaded:function(settings){if(typeof(settings.user)!='undefined'&&settings.user!=null){DZ.user_id=settings.user.id;}
if(typeof(settings.framework)!='undefined'){DZ.framework.onLoad(settings.framework);}
if(typeof(settings.player)!='undefined'){DZ.player.onLoad(settings.player);}},inapploadedCount:0,inapploaded:function(data){console.log("inapp loaded",data);if(typeof(data)=='undefined'){data={};}
if(!playercontrol.player_loaded){Events.addEvent('DZ',Events.player.playerLoaded,function(){DZ.inapploaded(data);});return true;}
if(typeof(data.page)!='undefined'&&DZ.inapploadedCount>0){app.loadPageMode='basic';$.address.history(false);app.setPage(data.page);$.address.history(true);}
if(typeof(data.ajax_mode)=='boolean'&&data.ajax_mode){app.loadPageMode='ajax';}
app.scrollTop();if(DZ.inapploadedCount==0){DZ.player_controler.suscribeEvents();DZ.deezer.subscribeEvents();}
var get_user_id=typeof(data.user_id)=='boolean'&&data.user_id;var player_options=DZ.player_controler.onPlayerLoaded();var load_options={player:player_options,framework:{text:{add:trad.music.favorite_add_to_my_music,remove:trad.music.favorite_remove_to_my_music,add_playlist:trad.music.favorite_add_to_my_music,buy:trad.music.buy,share:trad.music.naboo_share_link}},user:(get_user_id?{id:USER.USER_ID}:null)};DZ.communication.callAppMethod("DZ.onDeezerLoaded",load_options);if(false&&DZ.inapploadedCount==1){var addressValue=$.address.value();var base_app_path=app.base_page;if(addressValue=='/'+base_app_path){$.address.value(base_app_path+'/');}else if(addressValue=='/'+base_app_path+"/"){$.address.value(base_app_path);}}
DZ.inapploadedCount++;},onReady:function(callback){if(typeof(callback)!='function'){return false;}
DZ.Event.ready(DZ.Event.SDK_READY,callback);},ready:function(callback){if(typeof(callback)!='function'){return false;}
DZ.Event.ready(DZ.Event.SDK_READY,callback);},setContantes:function(){return false;if(DZ.CONST_LOADED){return false;}
DZ.SETTING_PROTOCOL=document.location.protocol;DZ.SETTING_HOST_SITE=DZ.SETTING_PROTOCOL+"//"+DZ.SETTING_HOST_SITE;DZ.SETTING_HOST_CONNECT=DZ.SETTING_PROTOCOL+"//"+DZ.SETTING_HOST_CONNECT;DZ.SETTING_HOST_API=DZ.SETTING_PROTOCOL+"//"+DZ.SETTING_HOST_API;DZ.CONST_LOADED=true;return true;},init:function(options){try{DZ.setContantes();DZ.initException();if(typeof(options)!='undefined'&&typeof(options.initChannel)!='undefined'&&options.initChannel){return DZ.initChannel(options);}
DZ.dz_root=document.getElementById('dz-root');if(DZ.dz_root==null){throw DZ.Exception('dz-root');}
if(typeof(options.inapp)!="undefined"){DZ.inapp=true;DZ.is_inapp=true;}
if(typeof(options.token)!='undefined'&&options.token!=null){if(typeof(options.token.accessToken)!='undefined'&&typeof(options.token.expire)!='undefined'){DZ.token=options.token.accessToken;DZ.tokenExpire=options.token.expire;}}
DZ.dz_root.style.height="0px";DZ.dz_root.style.width="0px";if(typeof(options)=='undefined'||typeof(options.channelUrl)=='undefined')throw DZ.Exception('channelUrl');DZ.setChannelUrl(options.channelUrl);DZ.communication.init();DZ.initialized=true;if(options.initPlayer)return DZ.player_controler.init(options);if(typeof(options.appId)!='undefined'){DZ.app_id=options.appId;}
if(typeof(options.player)!='undefined'&&(options.player===true||typeof(options.player)=='object')){DZ.has_player=true;DZ.player.loadPlayer(options);}}catch(e){DZ.catchException(e);}},login:function(callback,opts){try{if(!DZ.initialized)throw DZ.Exception('init');DZ.Event.suscribe('login',DZ.loginCommonCallback,true);if(typeof(callback)=='function'){DZ.Event.suscribe('login',callback,true);}
var screen_x=typeof window.screenX!='undefined'?window.screenX:window.screenLeft;var screen_y=typeof window.screenY!='undefined'?window.screenY:window.screenTop;var screen_w=typeof window.outerWidth!='undefined'?window.outerWidth:document.documentElement.clientWidth;var screen_h=typeof window.outerHeight!='undefined'?window.outerHeight:(document.documentElement.clientHeight-22);var popup_w=645;var popup_h=430;var popup_left=screen_x+(screen_w/2)-(popup_w/2);var popup_top=screen_y+(screen_h/2)-(popup_h/2);var src=DZ.SETTING_HOST_CONNECT+"/oauth/auth.php?";var arg=new Array();arg.push("app_id="+this.app_id);arg.push("format=popup");arg.push("redirect_uri="+this.channelUrl);arg.push("response_type=token");var opts=opts||{};if(typeof(opts.perms)!='undefined'&&opts.perms!=""){arg.push("perms="+opts.perms);}
if(typeof(opts.scope)!='undefined'&&opts.scope!=""){arg.push("scope="+opts.scope);}
if(opts.fb_login){arg.push("fblogin=true");}
src=src+arg.join('&');window.open(src,"login",'top='+popup_top+',left='+popup_left+',width='+popup_w+',height='+popup_h+',location=yes',true);}catch(e){DZ.catchException(e);}},getLoginStatus:function(callback){try{if(!DZ.initialized)throw DZ.Exception('init');DZ.Event.suscribe('login',DZ.loginCommonCallback,true);if(typeof(callback)=='function'){DZ.Event.suscribe('login',callback,true);}
var connect_frame=document.createElement('iframe');connect_frame.style.display="none";var src=DZ.SETTING_HOST_CONNECT+"/oauth/auth.php?";var arg=new Array();arg.push("app_id="+this.app_id);arg.push("format=channel");arg.push("redirect_uri="+this.channelUrl);arg.push("response_type=token");src=src+arg.join('&');connect_frame.onload=function(){document.getElementById('dz-root').removeChild(connect_frame);};connect_frame.src=src;document.getElementById('dz-root').appendChild(connect_frame);}catch(e){DZ.catchException(e);}},loginCommonCallback:function(response){try{if(response.error){setTimeout(function(){throw DZ.Exception();},0);return;}
if(response.authResponse!=null){DZ.token=response.authResponse.accessToken;DZ.tokenExpire=response.authResponse.expire;DZ.user_id=response.userID;if(DZ.tokenExpire!=0){DZ.tokenExpireTimeout=window.setTimeout(function(){DZ.getLoginStatus();},(DZ.tokenExpire)*1000);}
if(DZ.has_player){DZ.player.onLogin();}}}catch(e){DZ.catchException(e);}},logout:function(){try{if(!DZ.initialized)throw DZ.Exception('init');var logout_frame=document.createElement('iframe');logout_frame.style.display="none";var src=DZ.SETTING_HOST_CONNECT+"/logout.php?";var arg=new Array();src=src+arg.join('&');logout_frame.onload=function(){document.getElementById('dz-root').removeChild(logout_frame);DZ.tokenExpireTimeout=null;DZ.token=null;DZ.tokenExpire=null;DZ.user_id=null;if(DZ.has_player){DZ.player.onLogout();}};logout_frame.src=src;document.getElementById('dz-root').appendChild(logout_frame);}catch(e){DZ.catchException(e);}},initChannel:function(){try{var hashSplitted=unescape(window.document.location.hash).substr(1).split('|');if(hashSplitted.length>1){var type=hashSplitted[0];if(type=="channel"){DZ.communication.proxy_channel(hashSplitted);}else if(type=='token'){var windowroot=window.opener||window.parent;var access_token=hashSplitted[1];var authResponse={authResponse:{accessToken:null,expire:null},status:'notconnected',userID:null};if(access_token!='null'&&access_token!='exception'){var token=access_token.split('&');var expire=token[1].split('=')[1]*1;token=token[0].split('=')[1];authResponse.authResponse.accessToken=token;authResponse.authResponse.expire=expire;authResponse.status='connected';authResponse.userID=hashSplitted[2];}else{authResponse.status=hashSplitted[2];if(access_token=='exception')authResponse.error=true;authResponse.authResponse=null;}
if(typeof(windowroot.DZ)=='undefined'){throw DZ.Exception("XD_ERROR");}
windowroot.DZ.Event.triggerEvent({evt:'login',args:authResponse});window.close();}}}catch(e){DZ.catchException(e);}},widget:{getPlayer:function(options){var options=options||{};if(typeof(options.type)=='undefined'||typeof(options.id)=='undefined'){throw"You must define a type AND an id ! (options.type, options.id)";return false;}
var width=options.width||400;var height=options.height||230;var playlist='true';var cover='true';var scover='true';var autoplay='false';if(typeof(options.playlist)!='undefined')playlist=options.playlist?'true':'false';if(typeof(options.cover)!='undefined')cover=options.cover?'true':'false';if(typeof(options.scover)!='undefined')scover=options.scover?'true':'false';if(typeof(options.autoplay)!='undefined')autoplay=options.autoplay?'true':'false';var code='<iframe scrolling="no" frameborder="0" allowTransparency="true" src="'
+DZ.SETTING_HOST_SITE+'/fr/plugins/player?'+'autoplay='+autoplay+'&playlist='+playlist+'&width='+width+'&height='+height+'&scover='+autoplay+'&type='+options.type+'&id='+options.id+'&title='+'" width="'+width+'" height="'+height+'"></iframe>';return code;}}};;
DZ.api=function(){try{var path=null,request_method='get',args=null,callback=false;switch(arguments.length){case 1:path=arguments[0];break;case 2:path=arguments[0];callback=arguments[1];break;case 3:path=arguments[0];if(typeof(arguments[1])=='string'){request_method=arguments[1];}else{args=arguments[1];}
callback=arguments[2];break;case 4:path=arguments[0];request_method=arguments[1];args=arguments[2];callback=arguments[3];break;default:break;}
var callback=callback||function(){};if(path==null||path==""){callback({error:'no path defined'});return false;}
DZ.SIMPLE_API.apiCall(path,request_method,args,callback);}catch(e){DZ.catchException(e);}};DZ.SIMPLE_API={callbacks:{},apiCall:function(path,request_method,args,callback){try{if(path[0]!="/")path="/"+path;var path_splitted=path.split('?');var path_args=new Array();if(path_splitted.length>1){path=path_splitted[0];path_args=path_splitted[1].split('&');}
var path=DZ.SETTING_HOST_API+path;if(request_method!='get')path_args.push("request_method="+request_method);if(args!=null){for(var property in args){path_args.push(property+"="+escape(args[property]));}}
path_args.push("output=jsonp");if(DZ.token!=null)path_args.push("access_token="+DZ.token);path_args.push("version=js-v"+DZ._version);DZ.request._send({path:path,path_args:path_args,callback:callback,callback_name:"callback"});}catch(e){DZ.catchException(e);}}};;
DZ.error={getError:function(error_type){var error={type:'COMMON',message:DZ.error.errors.COMMON};if(typeof(error_type)=='string'&&typeof(DZ.error.errors[error_type])!='undefined'){error.type=error_type;error.message=DZ.error.errors[error_type];}
return error;},errors:{'COMMON':'An error has occured','PLAYER_DATA_ALBUM_ID':'Album id doesn\'t exists !','PLAYER_DATA_PLAYLIST_ID':'Playlist id doesn\'t exists !','PLAYER_DATA_TRACK_LIST':'An error has occured with the track list you tried to load'}};;
DZ.Event={SDK_READY:'ready',MUSIC_END:'music.end',MUSIC_START:'music.start',PLAYER_LOADED:'player.loaded',common:{ERROR:'on_error'},player:{LOADED:'player_loaded',PLAY:'player_play',PAUSED:'player_paused',POSITION_CHANGED:'player_position',VOLUME_CHANGED:'volume_changed',SHUFFLE_CHANGED:'shuffle_changed',REPEAT_CHANGED:'repeat_changed',MUTE_CHANGED:'mute_changed',BUFFERING_CHANGED:'player_buffering',TRACKS_LOADED:'player_track_loaded',CURRENT_TRACK:'current_track',TRACKS_ORDER_CHANGED:'tracklist_changed'},navigation:{PAGE_CHANGED:'page_changed'},canvas:{SCROLL_BOTTOM:'scroll_bottom'},framework:{},callbacks:{'music.end':new Array(),'music.start':new Array(),'player.loaded':new Array()},deferredObjects:{},ready:function(evt,callback){try{if(typeof(evt)!='string'){return false;}
if(typeof(callback)!='function'){return false;}
if(typeof(DZ.Event.deferredObjects[evt])=='undefined'){DZ.Event.deferredObjects[evt]={evt:evt,callbacks:[],resolved:false,resolved_params:null};}
if(DZ.Event.deferredObjects[evt].resolved){callback(DZ.Event.deferredObjects[evt].resolved_params,DZ.Event.deferredObjects[evt].evt);}else{DZ.Event.deferredObjects[evt].callbacks.push(callback);}}catch(e){DZ.catchException(e);}},resolve:function(evt,args){try{if(typeof(evt)!='string'){return false;}
if(typeof(DZ.Event.deferredObjects[evt])=='undefined'){DZ.Event.deferredObjects[evt]={evt:evt,resolved_params:args,resolved:true,callbacks:[]};}
DZ.Event.deferredObjects[evt].resolved=true;DZ.Event.deferredObjects[evt].resolved_params=args;if(DZ.Event.deferredObjects[evt].callbacks.length>0){for(var i=0;i<DZ.Event.deferredObjects[evt].callbacks.length;i++){var callback=DZ.Event.deferredObjects[evt].callbacks[i];callback(DZ.Event.deferredObjects[evt].resolved_params,DZ.Event.deferredObjects[evt].evt);}}
DZ.Event.deferredObjects[evt].callbacks=null;return true;}catch(e){DZ.catchException(e);}},suscribe:function(evt,callback,once){try{if(!DZ.initialized&&evt!=DZ.Event.SDK_READY)throw DZ.Exception('init');if(typeof(callback)=='object')return DZ.Event.suscribeList(evt,callback,once);if(once)callback.once=true;switch(evt){case DZ.Event.MUSIC_END:case DZ.Event.MUSIC_START:DZ.Event.callbacks[evt].push(callback);break;default:if(typeof(DZ.Event.callbacks[evt])=='undefined')DZ.Event.callbacks[evt]=new Array();DZ.Event.callbacks[evt].push(callback);break;}}catch(e){DZ.catchException(e);}},subscribe:function(evt,callback,once){DZ.Event.suscribe(evt,callback,once);},suscribeList:function(evt,callbacks,once){try{for(var i=0;i<callbacks.length;i++){DZ.Event.suscribe(evt,callbacks[i],once);}}catch(e){DZ.catchException(e);}},unsuscribe:function(evt){try{if(!DZ.initialized)throw DZ.Exception('init');if(!evt||typeof(DZ.Event.callbacks[evt])=='undefined')return false;DZ.Event.callbacks[evt]=new Array();}catch(e){DZ.catchException(e);}},unsubscribe:function(evt){DZ.Event.unsuscribe(evt);},eventTriggered:function(response){try{return DZ.EVENT.triggerEvent(response);}catch(e){DZ.catchException(e);}},trigger:function(evt,args){if(typeof(evt)!='string'){return false;}
if(typeof(args)=='undefined'){args=null;}
var response={evt:evt,args:args};DZ.Event.triggerEvent(response);},triggerEvent:function(response){try{var args=(typeof(response.args)=='undefined')?null:response.args;if(response.evt&&DZ.Event.callbacks[response.evt]){var nbToExecute=DZ.Event.callbacks[response.evt].length;for(var i=0;i<nbToExecute;i++){DZ.Event.callbacks[response.evt][i](args,response.evt);DZ.Event.callbacks[response.evt][i].executed=true;}
var cleanedCallbacks=new Array();for(var i=0;i<DZ.Event.callbacks[response.evt].length;i++){if(!DZ.Event.callbacks[response.evt][i].executed||!DZ.Event.callbacks[response.evt][i].once)
cleanedCallbacks.push(DZ.Event.callbacks[response.evt][i]);}
DZ.Event.callbacks[response.evt]=cleanedCallbacks;}}catch(e){DZ.catchException(e);}}};;
DZ.displayException=function(e){if(typeof(console)=='undefined'||typeof(console.error)=='undefined'){return;}
if(typeof(e)!='object'){console.error(e);}else{console.error(document.location.href);console.error(e);console.log(e.message);console.error(e.stack);}}
DZ.log=function(){if(DZ.DEBUG&&typeof(console)!='undefined'&&typeof(console.log)!='undefined'){console.log(arguments);}};DZ.catchException=function(e){DZ.displayException(e);};DZ.initException=function(){if(typeof(console)=='undefined'||typeof(console.log)=='undefined'||typeof(console.error)=='undefined'){window.console={log:function(){return;},error:function(){return;var args=arguments;var outputString=[];for(i=0;i<args.length;i++){outputString.push(args[i]);}
alert("Error : "+outputString.join(' | '));}};}};DZ.Exception=function(type){var message;if(typeof(type)!='undefined'){message=typeof(DZ.Exceptions[type])=='undefined'?type:DZ.Exceptions[type];}else{message=DZ.Exceptions.common;}
if(DZ.DEBUG){var exception=new Error(message);if(typeof(exception.stack)!='undefined'){exception.stack=exception.stack.replace('Error:',DZ.Exceptions.type+':')}
return exception;}else{return message;}};DZ.Exceptions={type:"DzError",common:"An error has occured, please retry your action",init:"DZ has not been initialized, you must call DZ.init(options) first !",channelUrl:"You must define a channelUrl !",'dz-root':"dz-root is not defined",XD_ERROR:"Cannot access to top window, Your channel domain, protocol and port must match with your top frame.",PLAYER_NOT_LOADED:"You must load a player first !",COMMUNICATION_SECURITY:"SECURITY EXCEPTION, you are not supposed to use this function !"};;
DZ.deezer={loadbox:function(page){loadBox(page);},subscribeEvents:function(){infinite_scroll.active($("#inapp_iframe_container"));infinite_scroll.percent=90;Events.addEvent('DZ',Events.layout.infiniteScroll,function(evt,val){infinite_scroll.status=false;hideLoading();DZ.communication.callAppMethod("DZ.canvas.receiveEvent",{evt:'SCROLL_BOTTOM',val:val});});Events.addEvent('DZ',Events.user.addFavorite,function(evt,params){console.log("HEUUU ADD ???",params);var id_names=['ART_ID','RADIO_ID','PLAYLIST_ID','ALB_ID'];for(var i=0;i<id_names.length;i++){if(typeof(params[id_names[i]])!='undefined'){params.element_id=params[id_names[i]];break;}}
DZ.communication.callAppMethod('DZ.framework.onFavorite',{type:params.type,id:params.element_id,value:true});});Events.addEvent('DZ',Events.user.deleteFavorite,function(evt,params){var id_names=['ART_ID','RADIO_ID','PLAYLIST_ID','ALB_ID'];for(var i=0;i<id_names.length;i++){if(typeof(params[id_names[i]])!='undefined'){params.element_id=params[id_names[i]];break;}}
console.log("HEUUU DELETE ???",params);DZ.communication.callAppMethod('DZ.framework.onFavorite',{type:params.type,id:params.element_id,value:false});});},addToPlaylist:function(arg){var song_ids=arg.tracks;for(var i=0;i<song_ids.length;i++){song_ids[i]=[song_ids[i],0];}
api.call('song_getListAllData',{sng_ids:song_ids,user_id:USER.USER_ID},function(request,callback_parameters){if(request.error.length==0){musicbox.open(null,request.results.data,{position:'mouse',x:callback_parameters.x,y:callback_parameters.y});}},{x:arg.position.x,y:arg.position.y});},setCanvasSize:function(size){app.setSize(size);},triggerBodyClick:function(val){$('body').trigger('mouse'+val,true);},startDrag:function(param){app.startDragElement(param.type,param.id);},setPage:function(pageObject){var pathName=trim(pageObject.url,'/');var splitted=pathName.split('?');if(splitted.length>1){pageObject.location.search="?"+splitted[1];}
pageObject.location.pathname='/'+splitted[0];app.setPage(pageObject.location);},setAddressValue:function(value){var page="app/"+app.app_id+"/"+value;$.address.value(page);},share:function(obj){if(typeof(obj.type)=='undefined'||typeof(obj.id)=='undefined'){return false;}
var types={track:0,album:1,artist:2,playlist:3}
if(typeof(types[obj.type])=='undefined'){return false;}
sharebox.load(types[obj.type],obj.id);},buy:function(obj){if(typeof(obj.type)=='undefined'||typeof(obj.id)=='undefined'){return false;}
var types={track:true,album:true,playlist:true}
if(typeof(types[obj.type])=='undefined'){return false;}
loadFacebox('store/index.php?product_type='+obj.type+'&product_id='+obj.id);},addFavorite:function(favorite_element){var type=favorite_element.type;var id=favorite_element.id;if(type=='radio'||type=='artist'){var object_data={};object_data.type=type;if(type=='radio'){object_data.RADIO_ID=id;}else{object_data.ART_ID=id;}
console.log('ADD FAV',object_data);favorite.add(object_data);return true;}
var types={'playlist':{method:'playlist_getData',params:{playlist_id:id,array_default:['PLAYLIST_ID','TITLE','PARENT_USER_ID','PARENT_USERNAME']}},'album':{method:'album_getData',params:{alb_id:id,array_default:['ALB_ID','ALB_TITLE','ART_NAME']}}};if(typeof(types[type])=='undefined'){return false;}
var obj=types[type];var params={};params[obj.arg]=favorite_element.id;params.array_default=obj.array_default;api.call(obj.method,obj.params,function(request,callback_parameters){console.log('RESULT',request);if(request.error.length==0){var object_data=request.results;object_data.type=callback_parameters.type;favorite.add(object_data);}},{type:type});},removeFavorite:function(favorite_element){favorite_element.PLAYLIST_ID=favorite_element.id;favorite_element.ALB_ID=favorite_element.id;favorite_element.RADIO_ID=favorite_element.id;favorite_element.ART_ID=favorite_element.id;favorite.remove(favorite_element);},askFavorites:function(send_queue){var callback_values={};for(var type in send_queue){callback_values[type]=[];for(var i=0;i<send_queue[type].length;i++){callback_values[type][i]={id:send_queue[type][i],value:userData.isFavorite(type,send_queue[type][i])};}}
console.log("CALL BACK VALUE",callback_values);DZ.communication.callAppMethod('DZ.framework.callbackQueue',callback_values);}};;
DZ.communication={postMessage:false,testPostMessage:function(){if(typeof(window.postMessage)=='undefined'||typeof(window.postMessage.call)=='undefined'){return false;}
if(typeof(window.navigator)=='undefined'||typeof(window.navigator.userAgent)=='undefined'){return false;}
return true;},init:function(){try{if(DZ.communication.testPostMessage()){DZ.communication.postMessage=true;if(window.addEventListener){window.addEventListener("message",DZ.communication.receive,false);}else{document.attachEvent("onmessage",DZ.communication.receive);}}}catch(e){DZ.catchException(e);}},proxy_send:function(message,domain){try{var channelUrl=DZ.channelUrl;if(domain=="deezer"){channelUrl=(DZ.SETTING_HOST_SITE)+"/plugins/channel.php";}
var channel_message=DZ.JSON.stringify(message)+"";channel_message=channel_message.replace(/\|/g,'{pipe}');channelUrl=channelUrl+"#channel|"+channel_message;var iframeChannel=window.document.createElement('iframe');iframeChannel.src=channelUrl;iframeChannel.style.display="none";iframeChannel.onload=function(){window.document.getElementById('dz-root').removeChild(iframeChannel);};window.document.getElementById('dz-root').appendChild(iframeChannel);}catch(e){DZ.catchException(e);}},proxy_channel:function(hashSplitted){try{var message=hashSplitted[1];message=message.replace(/{pipe}/g,'|');var type=hashSplitted[0];try{message=eval("("+message+")");}catch(e){return false;}
if(typeof(message)=='undefined')return false;var target=eval("window.parent."+message.framePath);target.DZ.communication.receive(message);}catch(e){DZ.catchException(e);}},callAppMethod:function(method,args){var framePath='';if(typeof(DZ.inapp)!="undefined"){framePath='frames.dzapp';}else{framePath=='parent'}
DZ.communication.send(framePath,method,args,'app');},callDeezerMethod:function(method,args){var framePath='';if(typeof(DZ.inapp)!="undefined"){framePath='parent';}else{framePath=='frames.dzplayer'}
DZ.communication.send(framePath,method,args,'deezer');},send:function(framePath,method,args,domain){try{var domain=typeof(domain)=='undefined'?"app":domain;if(domain=='deezer'){if(typeof(DZ.inapp)!="undefined"){framePath='parent';}else{framePath='frames.dzplayer';}}else{if(typeof(DZ.inapp)!="undefined"){framePath='frames.dzapp';}else{framePath='parent';}}
var message={method:method,args:args};if(DZ.communication.postMessage){var iframeToSend=null;if(typeof(DZ.inapp)!="undefined"&&framePath=='frames.dzplayer'){framePath='parent';}
if(typeof(DZ.inapp)!="undefined"&&framePath=='parent'&&domain=='app'){framePath='frames.dzapp';}
if(framePath=='frames.dzplayer'){iframeToSend=DZ.player.player_iframe.contentWindow;}else{iframeToSend=eval("window."+framePath);}
var post_domain=domain=='app'?DZ.SETTING_HOST_APP:DZ.SETTING_HOST_SITE;iframeToSend.postMessage(DZ.JSON.stringify(message),post_domain);}else{message.framePath=framePath;DZ.communication.proxy_send(message,domain);}}catch(e){DZ.catchException(e);}},receive:function(evt){try{var data=evt;if(typeof(evt.data)!='undefined'){data=evt.data;}
if(typeof(data)=="string"){try{data=eval("("+data+")");}catch(e){return false;}}
if(typeof(data.method)=='undefined')return false;var fct=data.method.split('.');if(fct.length>0&&fct[0]=='DZ'){var fctToCall=window;for(i=0;i<fct.length;i++){if(typeof(fctToCall[fct[i]])!='undefined'){fctToCall=fctToCall[fct[i]];}else{throw DZ.Exception('COMMUNICATION_SECURITY');return false;}}
if(typeof(fctToCall)!='function'){throw DZ.Exception('COMMUNICATION_SECURITY');}}else{throw DZ.Exception('COMMUNICATION_SECURITY');return false;}
fctToCall(data.args);}catch(e){DZ.catchException(e);}}};;
DZ.JSON={stringify:function stringify(arg){var c,i,l,s='',v;switch(typeof arg){case'object':if(arg){if(arg.constructor==Array){for(i=0;i<arg.length;++i){v=stringify(arg[i]);if(s){s+=',';}
s+=v;}
return'['+s+']';}else if(typeof arg.toString!='undefined'){for(i in arg){v=stringify(arg[i]);if(typeof v!='function'){if(s){s+=',';}
s+=stringify(i)+':'+v;}}
return'{'+s+'}';}}
return'null';case'number':return isFinite(arg)?String(arg):'null';case'string':l=arg.length;s='"';for(i=0;i<l;i+=1){c=arg.charAt(i);if(c>=' '){if(c=='\\'||c=='"'){s+='\\';}
s+=c;}else{switch(c){case'\b':s+='\\b';break;case'\f':s+='\\f';break;case'\n':s+='\\n';break;case'\r':s+='\\r';break;case'\t':s+='\\t';break;default:c=c.charCodeAt();s+='\\u00'+Math.floor(c/16).toString(16)+
(c%16).toString(16);}}}
return s+'"';case'boolean':return String(arg);default:return'null';}},parse:function(text){var at=0;var ch=' ';function error(m){throw{name:'JSONError',message:m,at:at-1,text:text};}
function next(){ch=text.charAt(at);at+=1;return ch;}
function white(){while(ch){if(ch<=' '){next();}else if(ch=='/'){switch(next()){case'/':while(next()&&ch!='\n'&&ch!='\r'){}
break;case'*':next();for(;;){if(ch){if(ch=='*'){if(next()=='/'){next();break;}}else{next();}}else{error("Unterminated comment");}}
break;default:error("Syntax error");}}else{break;}}}
function string(){var i,s='',t,u;if(ch=='"'){outer:while(next()){if(ch=='"'){next();return s;}else if(ch=='\\'){switch(next()){case'b':s+='\b';break;case'f':s+='\f';break;case'n':s+='\n';break;case'r':s+='\r';break;case't':s+='\t';break;case'u':u=0;for(i=0;i<4;i+=1){t=parseInt(next(),16);if(!isFinite(t)){break outer;}
u=u*16+t;}
s+=String.fromCharCode(u);break;default:s+=ch;}}else{s+=ch;}}}
error("Bad string");}
function array(){var a=[];if(ch=='['){next();white();if(ch==']'){next();return a;}
while(ch){a.push(value());white();if(ch==']'){next();return a;}else if(ch!=','){break;}
next();white();}}
error("Bad array");}
function object(){var k,o={};if(ch=='{'){next();white();if(ch=='}'){next();return o;}
while(ch){k=string();white();if(ch!=':'){break;}
next();o[k]=value();white();if(ch=='}'){next();return o;}else if(ch!=','){break;}
next();white();}}
error("Bad object");}
function number(){var n='',v;if(ch=='-'){n='-';next();}
while(ch>='0'&&ch<='9'){n+=ch;next();}
if(ch=='.'){n+='.';while(next()&&ch>='0'&&ch<='9'){n+=ch;}}
v=+n;if(!isFinite(v)){error("Bad number");}else{return v;}}
function word(){switch(ch){case't':if(next()=='r'&&next()=='u'&&next()=='e'){next();return true;}
break;case'f':if(next()=='a'&&next()=='l'&&next()=='s'&&next()=='e'){next();return false;}
break;case'n':if(next()=='u'&&next()=='l'&&next()=='l'){next();return null;}
break;}
error("Syntax error");}
function value(){white();switch(ch){case'{':return object();case'[':return array();case'"':return string();case'-':return number();default:return ch>='0'&&ch<='9'?number():word();}}
return value();}};;
DZ.notify={layer_container:null,messages:{'logged30':true,'notLogged30':true,'simultaneousAccess':true},already_displayed:[],display:function(message){try{var DZ_notify_messages=DZ.notify.messages;var DZ_request=DZ.request;var DZ_notify_already_displayed=DZ.notify.already_displayed;var DZ_notify_display_callback=DZ.notify.display_callback;if(typeof(DZ_notify_messages[message])=='undefined'){throw DZ.Exception('common');}
if(message=='logged30'||message=='notLogged30'){if(typeof(DZ_notify_already_displayed[message])!='undefined'&&DZ_notify_already_displayed[message]){return false;}
DZ_notify_already_displayed[message]=true;}
var layer_url=DZ.SETTING_HOST_SITE+"/plugins/layer.php";DZ_request._send({path:layer_url,path_args:["message="+message,"display=app","output=jsonp"],callback:DZ_notify_display_callback});}catch(e){DZ.catchException(e);}},display_callback:function(json){try{var html=(typeof(json)!='undefined'&&typeof(json.html)!='undefined')?json.html:null;if(html==null){throw DZ.Exception('common');}
if(DZ.notify.layer_container==null){DZ.notify.layer_container=document.createElement('div');document.getElementById('dz-root').appendChild(DZ.notify.layer_container);}
DZ.notify.layer_container.innerHTML=html;}catch(e){DZ.catchException(e);}},close_layer:function(){try{if(DZ.notify.layer_container==null){return false;}
DZ.notify.layer_container.innerHTML="";}catch(e){DZ.catchException(e);}}};;
DZ.player={loaded:false,player_iframe:null,player_type:null,onLoad:function(settings){DZ.player.loaded=true;if(typeof(settings)=="string"){try{settings=eval('('+settings+')');}catch(e){settings={shuffle:false,volume:1,repeat:0,mute:false};}}
DZ.player._core.volume=settings.volume;DZ.player._core.repeat=settings.repeat;DZ.player._core.shuffle=settings.shuffle;DZ.player._core.mute=settings.mute;if(typeof(settings.current_track)!='undefined'){DZ.player._core.onCurrentSong(settings.current_track.id);}
DZ.Event.triggerEvent({evt:DZ.Event.player.LOADED,args:settings});},_cachee:function(){},receiveEvent:function(args){try{if(typeof(args)=="string"){try{args=eval("("+args+")");}catch(e){return false;}}
var event=args.evt;var value=typeof(args.val)=='undefined'?null:args.val;if(typeof(DZ.Event.player[event]!='undefined')){if(event=='TRACKS_LOADED'){DZ.player._core.onLoadedInPlayer(value);var songs=value.tracks;var args={};if(typeof(value.tracks)!='undefined'){args={tracks:songs};}else{if(typeof(value.error)!='string'){value.error='';}
args={error:DZ.error.getError(value.error)};}
DZ.Event.triggerEvent({evt:DZ.Event.player[event]+"_"+value.type+'_'+value.id,args:args});}else if(event=='TRACKS_ORDER_CHANGED'){DZ.player._core.changeOrder(value);DZ.Event.triggerEvent({evt:DZ.Event.player[event],args:value});}else if(event=='CURRENT_TRACK'){DZ.player._core.onCurrentSong(value);var track=DZ.player._core.getCurrentSong();DZ.Event.triggerEvent({evt:DZ.Event.player[event],args:{track:track,index:DZ.player._core.index}});}else if(event=='NOTIFY'){DZ.notify.display(value);}else if(event=='FB_LOGGED'){DZ.fb_logged=true;}else if(event=='PLAY'||event=='PAUSED'){DZ.Event.triggerEvent({evt:DZ.Event.player[event],args:DZ.Event.player[event]});}else{DZ.Event.triggerEvent({evt:DZ.Event.player[event],args:value});}}}catch(e){DZ.catchException(e);}},attachEvents:function(){DZ.Event.suscribe(DZ.Event.player.LOADED,function(){},true);var core_events=['LOADED','PLAY','PAUSED','VOLUME_CHANGED','SHUFFLE_CHANGED','REPEAT_CHANGED','MUTE_CHANGED'];for(var i=0;i<core_events.length;i++){DZ.Event.subscribe(DZ.Event.player[core_events[i]],DZ.player._core['on_'+DZ.Event.player[core_events[i]]]);}},loadPlayer:function(options){try{if(typeof(options.player)=='undefined'||typeof(options.appId)=='undefined'){throw"An error has occured !";}
var appId=options.appId;options=options.player;var default_options={playlist:false,cover:false};options=typeof(options)!='object'?{}:options;DZ.util.extend(default_options,options);options.drawPlayer=false;if(typeof(options)!='undefined'&&typeof(options.container)!='undefined'){options.drawPlayer=true;}
if(options.drawPlayer&&document.getElementById(options.container)==null){throw"id container does not exist !";return false;}
DZ.player.attachEvents();if(typeof(options.onload)=='function'){DZ.Event.suscribe('player_loaded',options.onload);}
DZ.player.player_type='light';if(typeof(DZ.inapp)!='undefined'){DZ.player_iframe=window.parent;DZ.player._core.type='inapp_first_list';return true;}
DZ.player.player_iframe=document.createElement('iframe');DZ.player.player_iframe.id="dzplayer";DZ.player.player_iframe.name="dzplayer";var src=DZ.SETTING_HOST_SITE+"/plugins/player.php?";var arg=new Array();arg.push("channel="+DZ.channelUrl);arg.push("app_id="+appId);var iframeId="dz-root";if(options.drawPlayer){if(typeof(options.cover)!='undefined')arg.push("cover="+(options.cover?'true':'false'));if(typeof(options.playlist)!='undefined')arg.push("playlist="+(options.playlist?'true':'false'));if(typeof(options.width)!='undefined')arg.push("width="+options.width);if(typeof(options.height)!='undefined')arg.push("height="+options.height);if(typeof(options.format)!='undefined')arg.push("format="+options.format);iframeId=options.container;DZ.player.player_iframe.style.display="block";DZ.player.player_iframe.style.height=(typeof(options.height)!='undefined')?(options.height+'px'):"100%";DZ.player.player_iframe.style.width=(typeof(options.width)!='undefined')?(options.width+'px'):"100%";DZ.player.player_iframe.style.border="0px solid black";DZ.player.player_iframe.frameBorder="no";DZ.player.player_iframe.scrolling="no";}else{DZ.player.player_iframe.style.position="absolute";DZ.player.player_iframe.style.width="10px";DZ.player.player_iframe.style.height="20px";DZ.player.player_iframe.allowTransparency="true";DZ.player.player_iframe.style.backgroundColor="transparent";DZ.player.player_iframe.style.border="0px solid black";DZ.player.player_iframe.frameBorder="no";DZ.player.player_iframe.scrolling="no";arg.push("emptyPlayer=true");}
src=src+arg.join('&');DZ.player.player_iframe.onload=function(){};DZ.player.player_iframe.src=src;document.getElementById(iframeId).appendChild(DZ.player.player_iframe);}catch(e){DZ.catchException(e);}},loadWidget:function(options){try{DZ.player.attachEvents();DZ.player.player_type='widget';var options=options||{};if(typeof(options.containerId)=='undefined'){throw"You must define a containerId (options.containerId) !";return false;}
var container=document.getElementById(options.containerId);if(typeof(container)=='undefined'||container==null){throw"The container you defined doesn't exists !";return false;}
var width=options.width||400;var height=options.height||230;var playlist='true';var cover='true';var scover='true';var autoplay='false';if(typeof(options.playlist)!='undefined')playlist=options.playlist?'true':'false';if(typeof(options.cover)!='undefined')cover=options.cover?'true':'false';if(typeof(options.scover)!='undefined')scover=options.scover?'true':'false';if(typeof(options.autoplay)!='undefined')autoplay=options.autoplay?'true':'false';var src=DZ.SETTING_HOST_SITE+'/fr/plugins/player?'+'autoplay='+autoplay+'&playlist='+playlist+'&width='+width+'&height='+height+'&scover='+autoplay+'&title=';src+="&type=songList";src+="&songIds="+options.songIds.join(',');src+="&dzwidget=true";src+="&channel="+DZ.channelUrl;DZ.player.player_iframe=document.createElement('iframe');DZ.player.player_iframe.id="dzplayer";DZ.player.player_iframe.src=src;DZ.player.player_iframe.style.width=width+"px";DZ.player.player_iframe.style.height=height+"px";DZ.player.player_iframe.style.border="none";container.appendChild(DZ.player.player_iframe);}catch(e){DZ.catchException(e);}},onLogin:function(){DZ.communication.send("frames.dzplayer","DZ.player_controler.onLogin",null,'deezer');},onLogout:function(){DZ.communication.send("frames.dzplayer","DZ.player_controler.onLogout",null,'deezer');},play:function(){try{if(!DZ.player.loaded){throw DZ.Exception('PLAYER_NOT_LOADED');return false;}
if(!DZ.player._core.isRunning()){return false;}
DZ.communication.send("frames.dzplayer","DZ.player_controler.doAction",{command:'play'},'deezer');}catch(e){DZ.catchException(e);}},pause:function(){try{if(!DZ.player.loaded){throw DZ.Exception('PLAYER_NOT_LOADED');return false;}
if(!DZ.player._core.isRunning())return false;DZ.communication.send("frames.dzplayer","DZ.player_controler.doAction",{command:'pause'},'deezer');}catch(e){DZ.catchException(e);}},next:function(){try{if(!DZ.player.loaded){throw DZ.Exception('PLAYER_NOT_LOADED');return false;}
if(!DZ.player._core.isRunning())return false;DZ.communication.send("frames.dzplayer","DZ.player_controler.doAction",{command:'next'},'deezer');}catch(e){DZ.catchException(e);}},prev:function(){try{if(!DZ.player.loaded){throw DZ.Exception('PLAYER_NOT_LOADED');return false;}
if(!DZ.player._core.isRunning())return false;DZ.communication.send("frames.dzplayer","DZ.player_controler.doAction",{command:'prev'},'deezer');}catch(e){DZ.catchException(e);}},seek:function(value){try{if(!DZ.player.loaded){throw DZ.Exception('PLAYER_NOT_LOADED');return false;}
if(!DZ.player._core.isRunning())return false;DZ.communication.send("frames.dzplayer","DZ.player_controler.doAction",{command:'seek',value:(value/100)},'deezer');}catch(e){DZ.catchException(e);}},beforePlay:function(){if(DZ.fb_logged&&DZ.token==null){DZ.login(function(){},{fb_login:true});DZ.fb_logged=false;}},get_play_fct_args:function(args){try{switch(args.length){case 1:break;case 2:if(typeof(arguments[1])=='function'){callback=arguments[1];}else if(typeof(arguments[1])=='number'){index=arguments[1];}
break;case 3:if(typeof(arguments[1])=='number')index=arguments[1];if(typeof(arguments[2])=='function')callback=arguments[2];break;}}catch(e){DZ.catchException(e);}},getPlayArguments:function(args){try{var return_args={id:0,index:0,autoplay:true,callback:function(){},offset:null};var types_index={'function':0,'number':0,'boolean':0};for(var i=1;i<args.length;i++){var type=typeof(args[i]);switch(type){case'function':if(types_index['function']==0){return_args.callback=args[i];}
types_index['function']++;break;case'number':if(types_index['number']==0){return_args.index=args[i];}
if(types_index['number']==1){return_args.offset=args[i];}
types_index['number']++;break;case'boolean':if(types_index['boolean']==0){return_args.autoplay=args[i];}
types_index['boolean']++;break;default:break;}}
return return_args;}catch(e){}},_getPlayArguments:function(args){try{arguments=args;var return_args={id:0,index:0,autoplay:true,callback:function(){},offset:null};if(arguments.length==1){return return_args;}
var type_to_varname={'number,boolean,number,function':['index','autoplay','offset','callback'],'number,boolean,number':['index','autoplay','offset'],'number,boolean,function':['index','autoplay','callback'],'boolean,number,function':['autoplay','offset','callback'],'number,number':['index','offset'],'number,boolean':['index','autoplay'],'number,function':['index','callback'],'boolean,function':['autoplay','callback'],'boolean,number':['autoplay','offset'],'number':['index'],'boolean':['autoplay'],'function':['callback']}
var typeof_args=[];for(i=1;i<arguments.length;i++){typeof_args.push(typeof(arguments[i]));}
var my_args=typeof_args.join(',');while(typeof(type_to_varname[my_args])=='undefined'&&typeof_args.length>0){typeof_args=typeof_args.slice(0,typeof_args.length-1);my_args=typeof_args.join(',');}
if(my_args==''){return return_args;}
var varnames=type_to_varname[my_args];for(var i=0;i<varnames.length;i++){return_args[varnames[i]]=arguments[i+1];}
return return_args;}catch(e){DZ.catchException(e);}},commonPlay:function(args){try{if(!DZ.player.loaded){throw DZ.Exception('PLAYER_NOT_LOADED');return false;}
DZ.player.beforePlay();}catch(e){DZ.catchException(e);}},playTracks:function(){try{DZ.player.commonPlay();if(arguments.length==0||(typeof(arguments[0])!='object')){return false;}
var play_arguments=DZ.player.getPlayArguments(arguments);play_arguments.tracks=arguments[0];var trackList=play_arguments.tracks.join('|');DZ.Event.suscribe(DZ.Event.player.TRACKS_LOADED+"_playTracks_"+trackList,[function(data){play_arguments.callback(data);}],true);DZ.player._core.setType("playTracks",trackList);DZ.communication.send("frames.dzplayer","DZ.player_controler.playTracks",{trackList:trackList,index:play_arguments.index,autoplay:play_arguments.autoplay,offset:play_arguments.offset},'deezer');}catch(e){DZ.catchException(e);}},tracks_queuing:{},addToQueue:function(track_ids,callback){try{var tracks=[];for(var i=0;i<track_ids.length;i++){var id=track_ids[i];if(!DZ.player._core.trackIdExists(id)&&typeof(DZ.player.tracks_queuing['id_'+id])=='undefined'){tracks.push(id);DZ.player.tracks_queuing['id_'+id]=true;}}
if(tracks.length==0){return false;}
var callback=typeof(callback)=='undefined'?function(){}:callback;var trackList=tracks.join('|');DZ.Event.suscribe(DZ.Event.player.TRACKS_LOADED+"_playTracks_"+trackList,[function(data){if(typeof(data.tracks)!='undefined'){for(var i=0;i<data.tracks.length;i++){var track_id=data.tracks[i].id;if(typeof(DZ.player.tracks_queuing['id_'+track_id])!='undefined'){delete DZ.player.tracks_queuing['id_'+track_id];}}}
callback(data);}],true);DZ.player._core.setType("playTracks",trackList);DZ.communication.callDeezerMethod("DZ.player_controler.playTracks",{trackList:trackList,index:0,autoplay:true,offset:null,queue:true});}catch(e){DZ.catchException(e);}},playPlaylist:function(){try{DZ.player.commonPlay();if(arguments.length==0||(typeof(arguments[0])!='number')){return false;}
var play_arguments=DZ.player.getPlayArguments(arguments);play_arguments.playlist_id=arguments[0];var playlist_id=play_arguments.playlist_id;DZ.Event.suscribe(DZ.Event.player.TRACKS_LOADED+"_playPlaylist_"+playlist_id,[function(data){play_arguments.callback(data);}],true);DZ.player._core.setType("playPlaylist",playlist_id);DZ.communication.send("frames.dzplayer","DZ.player_controler.playPlaylist",{playlist_id:playlist_id,index:play_arguments.index,autoplay:play_arguments.autoplay,offset:play_arguments.offset},'deezer');return true;}catch(e){DZ.catchException(e);}},playAlbum:function(){try{DZ.player.commonPlay();if(arguments.length==0||(typeof(arguments[0])!='string'&&typeof(arguments[0])!='number')){return false;}
var album_id=arguments[0];var play_arguments=DZ.player.getPlayArguments(arguments);DZ.Event.suscribe(DZ.Event.player.TRACKS_LOADED+"_playAlbum_"+album_id,[function(data){play_arguments.callback(data);}],true);DZ.player._core.setType("playAlbum",album_id);DZ.communication.send("frames.dzplayer","DZ.player_controler.playAlbum",{album_id:album_id,index:play_arguments.index,autoplay:play_arguments.autoplay,offset:play_arguments.offset},'deezer');}catch(e){DZ.catchException(e);}},playRadio:function(){try{DZ.player.commonPlay();if(arguments.length==0||(typeof(arguments[0])!='string'&&typeof(arguments[0])!='number')){return false;}
var radio_id=arguments[0];var play_arguments=DZ.player.getPlayArguments(arguments);DZ.Event.suscribe(DZ.Event.player.TRACKS_LOADED+"_playRadio_"+radio_id,[function(data){play_arguments.callback(data);}],true);DZ.player._core.setType("playRadio",radio_id);DZ.communication.send("frames.dzplayer","DZ.player_controler.playRadio",{radio_id:radio_id,index:0,autoplay:play_arguments.autoplay},'deezer');}catch(e){DZ.catchException(e);}},playSmartRadio:function(){try{DZ.player.commonPlay();if(arguments.length==0||(typeof(arguments[0])!='string'&&typeof(arguments[0])!='number')){return false;}
var radio_id=arguments[0];var play_arguments=DZ.player.getPlayArguments(arguments);DZ.Event.suscribe(DZ.Event.player.TRACKS_LOADED+"_playSmartRadio_"+radio_id,[function(data){play_arguments.callback(data);}],true);DZ.player._core.setType("playSmartRadio",radio_id);DZ.communication.send("frames.dzplayer","DZ.player_controler.playSmartRadio",{radio_id:radio_id,index:0,autoplay:play_arguments.autoplay},'deezer');}catch(e){DZ.catchException(e);}},playExternalTracks:function(){try{DZ.player.commonPlay();if(arguments.length==0||typeof(arguments[0])!='object'){return false;}
var trackList=arguments[0];var play_arguments=DZ.player.getPlayArguments(arguments);var trackList_join=trackList.join('|');DZ.player._core.setType("playExternalTracks",trackList);DZ.communication.send("frames.dzplayer","DZ.player_controler.playExternalTracks",{trackList:trackList,index:play_arguments.index,autoplay:play_arguments.autoplay,offset:play_arguments.offset},'deezer');}catch(e){DZ.catchException(e);}},setTrackList:function(songList,callback){try{if(!DZ.player.loaded){throw DZ.Exception('PLAYER_NOT_LOADED');return false;}
var callback=callback||function(){};DZ.Event.suscribe(DZ.Event.player.TRACKS_LOADED,callback,true);DZ.communication.send("frames.dzplayer","DZ.player_controler.setSongList",songList,'deezer');}catch(e){DZ.catchException(e);}},getTrackList:function(){return DZ.player._core.getTrackList();},getCurrentSong:function(){return DZ.player._core.getCurrentSong();},getCurrentTrack:function(){return DZ.player._core.getCurrentSong();},getCurrentIndex:function(){return DZ.player._core.index;},changeTrackOrder:function(new_order){try{if(!DZ.player.loaded){throw DZ.Exception('PLAYER_NOT_LOADED');return false;}
if(DZ.player.getTrackList().length==0){return false;}
DZ.communication.callDeezerMethod("DZ.player_controler.doAction",{command:'changeTrackOrder',value:new_order});}catch(e){DZ.catchException(e);}},setVolume:function(value){try{if(!DZ.player.loaded){throw DZ.Exception('PLAYER_NOT_LOADED');return false;}
DZ.communication.send("frames.dzplayer","DZ.player_controler.doAction",{command:'volume',value:(value)},'deezer');}catch(e){DZ.catchException(e);}},setShuffle:function(value){try{if(!DZ.player.loaded){throw DZ.Exception('PLAYER_NOT_LOADED');return false;}
DZ.communication.send("frames.dzplayer","DZ.player_controler.doAction",{command:'shuffle',value:(value)},'deezer');}catch(e){DZ.catchException(e);}},setRepeat:function(value){try{if(!DZ.player.loaded){throw DZ.Exception('PLAYER_NOT_LOADED');return false;}
value=Math.max(0,Math.min(2,value*1));DZ.communication.send("frames.dzplayer","DZ.player_controler.doAction",{command:'repeat',value:(value)},'deezer');}catch(e){DZ.catchException(e);}},getVolume:function(){return DZ.player._core.volume;},getShuffle:function(){return DZ.player._core.shuffle;},getRepeat:function(){return DZ.player._core.repeat;},getMute:function(){return DZ.player._core.mute;},isPlaying:function(){return DZ.player._core.playing;},_core:{playing:false,tracks:[],idToIndex:[],index:null,type:null,id:null,volume:0,shuffle:false,repeat:0,mute:false,on_player_loaded:function(settings){DZ.player._core.playing=settings.playing;},on_player_play:function(){DZ.player._core.playing=true;},on_player_paused:function(){DZ.player._core.playing=false;},on_volume_changed:function(value,evt){DZ.player._core.volume=value;},on_shuffle_changed:function(value,evt){DZ.player._core.shuffle=value;},on_repeat_changed:function(value,evt){DZ.player._core.repeat=value;},on_mute_changed:function(value,evt){DZ.player._core.mute=value;},changeOrder:function(new_order){var core=DZ.player._core;var new_tracks=[];var new_idToIndex=[];var index=0;var current_track_id=core.getCurrentSong().id;for(var i=0;i<new_order.length;i++){var id=new_order[i];if(typeof(core.idToIndex["id_"+id])!='undefined'){var track=core.tracks[core.idToIndex["id_"+id]];new_tracks.push(track);new_idToIndex["id_"+id]=index;if(id==current_track_id){core.index=index;}
index++;}}
DZ.player._core.tracks=new_tracks;DZ.player._core.idToIndex=new_idToIndex;},trackIdExists:function(track_id){return typeof(DZ.player._core.idToIndex['id_'+track_id])!='undefined';},isRunning:function(){return(DZ.player._core.tracks!=null&&DZ.player._core.index!=null&&DZ.player._core.type!=null);},setType:function(type,id){DZ.player._core.type=type;DZ.player._core.id=id;},onLoadedInPlayer:function(data){console.log('DZ.player._core.onLoadedInPlayer',data);if(typeof(data.error)!='undefined'||data.type!=DZ.player._core.type||data.id!=DZ.player._core.id)return false;DZ.player._core.tracks=data.tracks;DZ.player._core.idToIndex=[];for(i=0;i<DZ.player._core.tracks.length;i++){DZ.player._core.idToIndex["id_"+DZ.player._core.tracks[i].id]=i;}
var index=0;if(typeof(data.index)!='undefined'){index=Math.max(0,Math.min(data.index,DZ.player._core.tracks.length-1));}
DZ.player._core.index=index;},onCurrentSong:function(sng_id){if(typeof(DZ.player._core.idToIndex["id_"+sng_id])!='undefined'){DZ.player._core.index=DZ.player._core.idToIndex["id_"+sng_id];}},getTrackList:function(){if(!DZ.player._core.isRunning())return[];return DZ.player._core.tracks;},getCurrentSong:function(){if(!DZ.player._core.isRunning())return null;var core=DZ.player._core;if(!core.isRunning()||core.index<0||core.index>=core.tracks.length){return null;}
return core.tracks[core.index];},next:function(){},prev:function(){}}};;
DZ.player_controler={abstract_methods:['onPlayerLoaded','onLogin','onLogout','suscribeEvents','doAction','playTracks','playAlbum','playRadio','playSmartRadio','setSongList'],parent:{'suscribeEvents':null,'convertData':null,'doAction':null},init:function(options){try{DZ.player_controler.suscribeEvents();options.widgetOptions.drawPlayer=typeof(options.widgetOptions.emptyPlayer)=='undefined';widget.init(options);return true;}catch(e){DZ.catchException(e);}},initMethods:function(){for(var i=0;i<DZ.player_controler.abstract_methods.length;i++){var method_name=DZ.player_controler.abstract_methods[i];if(typeof(DZ.player_controler[method_name])=='undefined'){DZ.player_controler[method_name]=function(){};}}
for(var method in DZ.player_controler.parent){if(typeof(DZ.player_controler[method])!='undefined'){DZ.player_controler.parent[method]=DZ.player_controler[method];}}},doAction:function(args){try{var command=args.command;var value=typeof(args.value)=='undefined'?null:args.value;if(command=='shuffle'){if(value!=dzPlayer.isShuffle()){playercontrol.doAction('shuffle');}
return true;}
if(command=='repeat'){value=Math.max(0,Math.min(2,value*1));if(value!=dzPlayer.getRepeat()){playercontrol.doAction('repeat',value);}
return true;}
if(command=='changeTrackOrder'){playercontrol.changeTrackOrder(value);return true;}
playercontrol.doAction(command,[value]);}catch(e){DZ.catchException(e);}},suscribeEvents:function(){try{Events.addEvent('DZ',Events.player_widget.loaded,DZ.player_controler.onPlayerLoaded);Events.addEvent('DZ',Events.player.play,function(evt,val){DZ.communication.send("parent","DZ.player.receiveEvent",{evt:'PLAY'});});Events.addEvent('DZ',Events.player.resume,function(evt,val){DZ.communication.send("parent","DZ.player.receiveEvent",{evt:'PLAY'});});Events.addEvent('DZ',Events.player.paused,function(evt,val){DZ.communication.send("parent","DZ.player.receiveEvent",{evt:'PAUSED'});});Events.addEvent('DZ',Events.player.position,function(evt,val){if(val==null)val=0;DZ.communication.send("parent","DZ.player.receiveEvent",{evt:'POSITION_CHANGED',val:[val,dzPlayer.duration]});});Events.addEvent('DZ',Events.player.volume_changed,function(evt,val){if(val==null)val=0;DZ.communication.send("parent","DZ.player.receiveEvent",{evt:'VOLUME_CHANGED',val:val});});Events.addEvent('DZ',Events.player.shuffle_changed,function(evt,val){if(val==null)val=0;DZ.communication.send("parent","DZ.player.receiveEvent",{evt:'SHUFFLE_CHANGED',val:val});});Events.addEvent('DZ',Events.player.repeat_changed,function(evt,val){if(val==null)val=0;DZ.communication.send("parent","DZ.player.receiveEvent",{evt:'REPEAT_CHANGED',val:val});});Events.addEvent('DZ',Events.player.mute_changed,function(evt,val){if(val==null)val=0;DZ.communication.send("parent","DZ.player.receiveEvent",{evt:'MUTE_CHANGED',val:val});});Events.addEvent('DZ',Events.player.pourcentLoaded,function(evt,val){DZ.communication.send("parent","DZ.player.receiveEvent",{evt:'BUFFERING_CHANGED',val:val});});Events.addEvent('DZ',Events.player.displayCurrentSong,function(evt,val){if(val==null)val=0;DZ.communication.send("parent","DZ.player.receiveEvent",{evt:'CURRENT_TRACK',val:dzPlayer.getCurrentSongInfo().SNG_ID});});Events.addEvent('DZ','player_track_loaded',function(evt,data){if(typeof(data.tracks)!='undefined'){var widgetLines=data.tracks;var tracks=new Array();for(i=0;i<widgetLines.length;i++){var track=DZ.player_controler.convertData(widgetLines[i]);tracks.push(track);}
data.tracks=tracks;}
DZ.communication.callAppMethod("DZ.player.receiveEvent",{evt:'TRACKS_LOADED',val:data});});Events.addEvent('DZ',Events.player_widget.displayLayer,function(evt,data){DZ.communication.send("parent","DZ.player.receiveEvent",{evt:'NOTIFY',val:data});});return true;}catch(e){DZ.catchException(e);}},convertData:function(data){try{var track={};track.id=data.SNG_ID;track.duration=data.DURATION;track.title=data.SNG_TITLE;track.artist={id:data.ART_ID,name:data.ART_NAME};track.album={id:data.ALB_ID,title:data.ALB_TITLE}
return track;}catch(e){DZ.catchException(e);}}};DZ.player_controler.initMethods();;
DZ.player_controler.onPlayerLoaded=function(){try{DZ.player_controler.playerLoaded=true;DZ.communication.send("parent","DZ.onDeezerLoaded",{player:{volume:dzPlayer.getVolume()*100,shuffle:dzPlayer.isShuffle(),repeat:dzPlayer.getRepeat(),muted:dzPlayer.isMuted()}});}catch(e){DZ.catchException(e);}};DZ.player_controler.onLogin=function(){user.userLogin(function(){widget.initRestriction();});};DZ.player_controler.onLogout=function(){dzPlayer.setForbiddenListen(true);user.logout(true,false);widget.initRestriction();};DZ.player_controler.playTracks=function(arg){try{DZ.log("player_control.playTracks",arg);var offset=null;if(typeof(arg.offset)=='number'&&arg.index<arg.trackList.length){offset=arg.offset;}
widget.loadSongs(arg.trackList.split('|'),function(tracks){Events.trigger("player_track_loaded",{tracks:tracks,type:'playTracks',id:arg.trackList});},arg.autoplay,arg.index,arg.offset);}catch(e){DZ.catchException(e);}};DZ.player_controler.playPlaylist=function(arg){try{DZ.log("playPlaylist",arg);widget.loadPlaylist(arg.playlist_id,function(tracks){Events.trigger("player_track_loaded",{tracks:tracks,type:'playPlaylist',id:arg.playlist_id});},arg.autoplay,arg.index,arg.offset);}catch(e){DZ.catchException(e);}};DZ.player_controler.playAlbum=function(arg){try{DZ.log("playPlaylist",arg);widget.loadAlbum(arg.album_id,function(tracks){Events.trigger("player_track_loaded",{tracks:tracks,type:'playAlbum',id:arg.album_id});},arg.autoplay,arg.index,arg.offset);}catch(e){DZ.catchException(e);}};DZ.player_controler.playRadio=function(arg){try{DZ.log("playRadio",arg);widget.loadRadio('radio-'+arg.radio_id,function(tracks){Events.trigger("player_track_loaded",{tracks:tracks,type:'playRadio',id:arg.radio_id});},arg.autoplay,0);}catch(e){DZ.catchException(e);}};DZ.player_controler.playSmartRadio=function(arg){try{DZ.log("playRadio",arg);widget.loadRadio('artist-'+arg.radio_id,function(tracks){Events.trigger("player_track_loaded",{tracks:tracks,type:'playSmartRadio',id:arg.radio_id});},arg.autoplay,0);}catch(e){DZ.catchException(e);}};DZ.player_controler.setSongList=function(songList){try{player_light.loadSongs(songList);}catch(e){DZ.catchException(e);}};;
DZ.request={callbacks:{},_send:function(options){try{var options=(typeof(options)=='undefined')?{}:options;var options=DZ.util.extend({path:null,path_args:[],callback_name:'callback',callback:function(){}},options);var callback_uniq_name=DZ.request.getUniqFctName();DZ.request.callbacks[callback_uniq_name]=options.callback;options.path_args.push(options.callback_name+"=DZ.request.callbacks."+callback_uniq_name);var script=document.createElement('script');script.onload=function(){document.getElementById('dz-root').removeChild(script);DZ.request.callbacks[callback_uniq_name]=null;delete DZ.request.callbacks[callback_uniq_name];}
script.src=options.path+'?'+options.path_args.join('&');document.getElementById('dz-root').appendChild(script);}catch(e){DZ.catchException(e);}},getUniqFctName:function(){try{var prefix="dzcb_";var retId;var formatSeed=function(seed,reqWidth){seed=parseInt(seed,10).toString(16);if(reqWidth<seed.length){return seed.slice(seed.length-reqWidth);}
if(reqWidth>seed.length){return Array(1+(reqWidth-seed.length)).join('0')+seed;}
return seed;};if(!this.php_js){this.php_js={};}
if(!this.php_js.uniqidSeed){this.php_js.uniqidSeed=Math.floor(Math.random()*0x75bcd15);}
this.php_js.uniqidSeed+=3;retId=prefix;retId+=formatSeed(parseInt(new Date().getTime()/1000,10),10);retId+=formatSeed(this.php_js.uniqidSeed,7);retId+="_"+Math.floor((Math.random()*10).toFixed(7)*100000000).toString();return retId;}catch(e){DZ.catchException(e);}}};;
DZ.util={extend:function(){try{var args=arguments;if(args.length==0||typeof(args[0])!='object'){throw DZ.Exception("extend arguments[0] is not an object");}
var object=args[0];for(var i=1;i<args.length;i++){if(typeof(args[i])!='object')continue;for(key in args[i]){object[key]=args[i][key];}}
return object;}catch(e){DZ.catchException(e);}},parseUrl:function(str){var o={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}};var m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;while(i--)uri[o.key[i]]=m[i]||"";uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){if($1)uri[o.q.name][$1]=$2;});return uri;},setCookie:function(name,value,expiredays){var exdate=new Date();exdate.setDate(exdate.getDate()+expiredays);document.cookie=name+"="+escape(value)+"; path=/"+
((expiredays==null)?"":";expires="+exdate.toGMTString());},getCookie:function(name){if(document.cookie.length>0){c_start=document.cookie.indexOf(name+"=");if(c_start!=-1){c_start=c_start+name.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end==-1)c_end=document.cookie.length;return unescape(document.cookie.substring(c_start,c_end));}}
return'';}};;
DZ.init({initChannel:true});if(typeof(window.dzAsyncInit)!='undefined'){window.dzAsyncInit();};